# 病毒组分析流程配置

# 运行环境配置
env:
  # Conda环境激活命令
  activate_cmd: source /cpfs01/projects-HDD/cfff-47998b01bebd_HDD/rj_24212030018/miniconda3/bin/activate && source activate /cpfs01/projects-HDD/cfff-47998b01bebd_HDD/rj_24212030018/miniconda3/envs/vs2
  # 模块加载命令 (建议仅用于CFFF模式)
  module_load: module load CentOS/7.9/Anaconda3/24.5.0 && module load CentOS/7.9/singularity/3.9.2

# 批量脚本生成默认参数 (make.py)
batch:
  # slurm | cfff
  scheduler: slurm
  threads: 8
  mem: 60
  # reads 模式下默认宿主 (可为逗号分隔, 会透传给 run_upstream.py 的 --host)
  host: human

# 软件路径
software:
  fastp: fastp
  bowtie2: bowtie2
  megahit: megahit
  vsearch: vsearch
  checkv: checkv
  virsorter: virsorter
  genomad: genomad
  seqkit: seqkit
  vclust: vclust
  phabox2: phabox2
  prokka: prokka
  cdhit: cd-hit-est
  coverm: coverm

# 软件参数
parameters:
  # reads 在运行 fastp 前先拷贝到样本输出目录，避免 Singularity/路径可见性问题
  # 默认 false (CFFF模式推荐 false, SLURM模式推荐 true)
  stage_reads: false
  # fastp 失败时是否保留 staging 文件用于排查
  stage_keep_on_fail: true

  vsearch: --minseqlength 1500
  
  # VirSorter2 三步参数
  virsorter_pass1: --keep-original-seq --include-groups dsDNAphage,ssDNA --min-length 5000 --min-score 0.5
  virsorter_pass2: --seqname-suffix-off --viral-gene-enrich-off --provirus-off --prep-for-dramv --include-groups dsDNAphage,ssDNA --min-length 5000 --min-score 0.5
  
  # geNomad 参数
  genomad: --cleanup
  
  vclust: --min-ident 0.95 --out-ani 0.95
  coverm: --min-read-percent-identity 95 --min-read-aligned-percent 75 -m count --output-format dense
  
  # BUSCO过滤阈值 (BUSCO基因/总基因 > 阈值则认为是细菌污染, < 5%)
  busco_ratio_threshold: 0.05

# 病毒检测工具选择
virus_detection:
  enable_virsorter: true
  enable_genomad: true
  min_tools_required: 1  # 至少几个工具检测到才认为是病毒（取并集）

# 数据库路径
database:
  # 宿主去重数据库目录 (包含各个宿主的bowtie2索引目录)
  bowtie2_index: ~/db/bowtie2_index
  
  # 病毒检测数据库
  checkv: ~/db/checkv
  virsorter: ~/db/db
  genomad: ~/db/genomad
  
  # 质量评估数据库
  busco: ~/db/bacteria_odb12
  
  # 其他数据库
  phabox2: ~/db/phabox2
  blastn: ~/db/blastn_database

# Singularity 容器配置
singularity:
  enabled: true  # 是否启用 Singularity 模式
  sif_dir: ~/sif  # SIF 文件目录
  binds: []  # 挂载路径列表，根据实际需要添加，如: ["/path/to/data:/data", "~/db:/db"]
  
  # 软件到 SIF 文件的映射 (如果软件名和 SIF 文件名不同)
  sif_mapping:
    fastp: fastp.sif
    bowtie2: bowtie2.sif
    megahit: megahit.sif
    vsearch: vsearch.sif
    checkv: checkv.sif
    virsorter: virsorter2.sif
    genomad: genomad.sif
    seqkit: seqkit.sif
    busco: busco.sif
    vclust: vclust.sif
    phabox2: phabox2.sif
    prokka: prokka.sif
    cdhit: cdhit.sif
    coverm: coverm.sif

